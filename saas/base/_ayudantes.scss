@use "sass:map";

@mixin variables-css($css_variables, $prefix: tema) {
    @each $name, $value in $css_variables {
        --#{$prefix}-#{$name}: #{$value};
    }
}

@function var-css($name, $prefix: tema) {
    @return var(--#{$prefix}-#{$name});
}

@mixin asignar-var-css($name, $value: '', $prefix: tema) {
    --#{$prefix}-#{$name}: #{$value};
}

@function evaluar-color($color) {
    @if contrast-ratio($color, $white) > $min-contrast-ratio {
        @return 'oscuro';
    } @else {
        @return 'claro';
    }
}

@function cambiar-saturacion($color, $cantidad) {
    $gray: mix(black, white, 50%);
    @return mix($color, $gray, $cantidad);
}

@function cambiar-luminosidad($color, $weight) {
    @if evaluar-color($color) == 'oscuro' {
        @return if($weight > 0, mix($color, black, $weight), mix($color, white, -$weight));
    } @else {
        @return if($weight > 0, mix($color, white, $weight), mix($color, black, -$weight));
    }
}

@function cambiar-matiz($color, $degrees) {
    @return hsl(hue($color) + $degrees, saturation($color), lightness($color));
}

@function ajustar-matiz-al-tema($color, $target-hue) {
    $current-hue: hue($color);
    $hue-difference: $target-hue - $current-hue;
    @if abs($hue-difference) > 180 {
        $hue-difference: $hue-difference - 360 * if($hue-difference > 0, -1, 1);
    }
    @return cambiar-matiz($color, $hue-difference);
}

@function crear-escala-multicolor($color) {
    $scale: ();
    $increment: 15;
    $base-level: 500;
    $steps: 9;
    @for $i from -$steps through $steps {
        @if $i != 0 {
            $adjusted-color: adjust-hue($color, $increment * $i);
            $nivel: $base-level - $i * 50;
            $scale: map-merge($scale, ('multi-' + $nivel: $adjusted-color));
        }
    }
    $scale: map-merge($scale, ('multi-' + $base-level: $color));
    @return $scale;
}

@function crear-escala-monocromatica($color) {
    $scale: ();
    $lightness: lightness($color);
    @for $i from 1 through 9 {
        $new-color: mix($color, white, 10% * $i);
        $scale: map-merge($scale, ('mono-' + (50 + ($i - 1) * 50): $new-color));
    }
    $scale: map-merge($scale, ('mono-500': $color));
    @for $i from 1 through 9 {
        $new-color: mix($color, black, 10% * $i);
        $scale: map-merge($scale, ('mono-' + (950 - ($i - 1) * 50): $new-color));
    }
    @return $scale;
}

@function crear-escala-saturacion($color-base) {
    $scale: ();
    $base-level: 500;
    $incremento-saturacion: 10%;
    @for $i from 1 through 9 {
        $color-saturado: saturate($color-base, $incremento-saturacion * $i);
        $color-desaturado: desaturate($color-base, $incremento-saturacion * $i);
        $scale: map-merge($scale, (
            'satu-' + ($base-level - $i * 50): $color-desaturado,
            'satu-' + ($base-level + $i * 50): $color-saturado
        ));
    }
    $scale: map-merge($scale, ('satu-500': $color-base));
    @return $scale;
}

@function generar-paleta-basica($color-base) {
    $invert-color: cambiar-matiz($color-base, 180deg);
    $light-color: lighten($color-base, 15%);
    $dark-color: darken($color-base, 15%);
    $primary-color: saturate($light-color, 20%);
    $secondary-color: desaturate($dark-color, 20%);
    $danger-color: saturate(lighten(ajustar-matiz-al-tema($color-base, 0), 10%), 10%);
    $success-color: desaturate(lighten(ajustar-matiz-al-tema($color-base, 120), 10%), 10%);
    $info-color: desaturate(lighten(ajustar-matiz-al-tema($color-base, 240), 10%), 10%);
    $warning-color: saturate(lighten(ajustar-matiz-al-tema($color-base, 60), 10%), 10%);
    $accent-color: cambiar-matiz($dark-color, 90deg);
    $soft-color: cambiar-matiz($light-color, 90deg);
    @if evaluar-color($color-base) == 'claro' {
        $danger-color: saturate(ajustar-matiz-al-tema($color-base, 0), 10%);
        $success-color: desaturate(ajustar-matiz-al-tema($color-base, 120), 10%);
        $info-color: desaturate(ajustar-matiz-al-tema($color-base, 240), 10%);
        $warning-color: saturate(ajustar-matiz-al-tema($color-base, 60), 10%);
    }
    @return (
        'primary': $primary-color,
        'secondary': $secondary-color,
        'success': $success-color,
        'info': $info-color,
        'warning': $warning-color,
        'danger': $danger-color,
        'light': $light-color,
        'dark': $dark-color,
        'accent': $accent-color,
        'soft': $soft-color,
        'invert': $invert-color,
        'grayscale': grayscale($color-base),
    );
}

@function generar-paleta-ampliada($color) {
    $analo-1: cambiar-matiz($color, 30deg);
    $analo-2: cambiar-matiz($color, -30deg);
    $triad-1: cambiar-matiz($color, 120deg);
    $triad-2: cambiar-matiz($color, 240deg);
    $contra: cambiar-matiz($color, 180deg);
    $comp-1: cambiar-matiz($contra, 15deg);
    $comp-2: cambiar-matiz($contra, -15deg);
    $tetra-1: cambiar-matiz($color, 60deg);
    $tetra-2: cambiar-matiz($color, -60deg);
    $cuad-1: cambiar-matiz($color, 90deg);
    $cuad-2: cambiar-matiz($color, -90deg);
    @return (
        'analo-1': $analo-1,
        'analo-2': $analo-2,
        'triad-1': $triad-1,
        'triad-2': $triad-2,
        'tetra-1': $tetra-1,
        'tetra-2': $tetra-2,
        'base': $color,
        'contra': $contra,
        'cuad-1': $cuad-1,
        'cuad-2': $cuad-2,
        'comp-1': $comp-1,
        'comp-2': $comp-2,
    );
}

@mixin configurar-tema($paleta-basica) {
    $color-base: map-get($paleta-basica, 'base');
    $paleta-ampliada: generar-paleta-ampliada($color-base) !default;
    $escala-multicolor: crear-escala-multicolor($color-base) !default;
    $escala-monocromatica: crear-escala-monocromatica($color-base) !default;
    $escala-saturacion: crear-escala-saturacion($color-base) !default;
    $color-light: map-get($paleta-basica, 'light');
    $texto-light: color-contrast($color-light);

    --bs-body-font-family: #{var-css(fuente-base)};
    --bs-body-font-size: #{var-css(talla-base)};
    --bs-body-color: #{var-css(texto)};
    --bs-body-color-rgb: #{var-css(texto-rgb)};
    --bs-body-bg: #{var-css(fondo)};
    --bs-body-bg-rgb: #{var-css(fondo-rgb)};
    --bs-box-shadow: 0 0.5rem 1rem #{var-css(sombra-rgba)};
    --bs-box-shadow-sm: 0 0.1rem .5rem #{var-css(sombra-rgba)};
    --bs-box-shadow-lg: 0 0.25rem 2rem #{var-css(sombra-rgba)};
    --bs-box-shadow-inset: inset 0 1px 2px #{var-css(sombra-rgba)};
    --bs-border-color: #{var-css(borde-color)};
    --bs-hr-color: #{var-css(hr-color)};

    --bs-secondary-color: #{var-css(texto2)};
    --bs-secondary-color-rgb: #{var-css(texto2-rgb)};
    --bs-secondary-bg: #{var-css(fondo2)};
    --bs-secondary-bg-rgb: #{var-css(fondo2-rgb)};
    --bs-tertiary-color: #{var-css(texto3)};
    --bs-tertiary-color-rgb: #{var-css(texto3-rgb)};
    --bs-tertiary-bg: #{var-css(fondo3)};
    --bs-tertiary-bg-rgb: #{var-css(fondo3-rgb)};
  
    @each $color, $value in $paleta-basica {
        --bs-#{$color}: #{$value};
        --bs-#{$color}-rgb: #{to-rgb($value)};
        --bs-#{$color}-text-emphasis: #{cambiar-luminosidad($value, -20%)};

        --bs-#{$color}-bg-subtle: #{cambiar-luminosidad($value, 80%)};
        --bs-#{$color}-border-subtle: #{cambiar-luminosidad($value, 50%)};

        .bg-#{$color} {
            background-color: $value !important;
        }
        .text-#{$color} {
            color: $value !important;
        }
        .text-bg-#{$color} {
            background-color: $value !important;
            color: color-contrast($value) !important;
        }
        .btn-#{$color} {
            @include button-variant($value, $value);
        }
        .btn-outline-#{$color} {
            @include button-outline-variant($value);
        }
    }
    @each $state in map-keys($paleta-basica) {
        .list-group-item-#{$state} {
            --bs-list-group-color: var(--bs-#{$state}-text-emphasis);
            --bs-list-group-action-hover-color: var(--bs-#{$state}-text-emphasis);
            --bs-list-group-action-active-color: var(--bs-#{$state}-text-emphasis);
            --bs-list-group-active-color: var(--bs-#{$state}-text-emphasis);
            --bs-list-group-border-color: #{var-css(borde-color)};
            --bs-list-group-active-border-color: #{var-css(borde-color)};
        }
    }
    @each $color, $value in $paleta-ampliada {
        --bs-#{$color}: #{$value};
        .bg-#{$color} {
            background-color: $value !important;
        }
        .text-#{$color} {
            color: $value !important;
        }
        .text-bg-#{$color} {
            background-color: $value !important;
            color: color-contrast($value) !important;
        }
    }

    @each $key, $value in $escala-monocromatica {
        --bs-#{$key}: #{$value};
        .escala-#{$key} {
            background-color: $value !important;
            color: color-contrast($value);
        }
    }
    @each $key, $value in $escala-saturacion {
        --bs-#{$key}: #{$value};
        .escala-#{$key} {
            background-color: $value !important;
            color: color-contrast($value);
        }
    }
    @each $key, $value in $escala-multicolor {
        .escala-#{$key} {
            background-color: $value !important;
            color: color-contrast($value);
        }
    }

    .nav-tabs {
        --bs-nav-tabs-border-color: #{var-css(borde-color)};
        --bs-nav-tabs-link-hover-border-color: #{var-css(borde-color)} #{var-css(borde-color)} transparent;
        --bs-nav-tabs-link-active-border-color: #{var-css(borde-color)} #{var-css(borde-color)} transparent;
        --bs-nav-link-color: #{var-css(texto)};
        --bs-nav-link-hover-color: #{var-css(texto)};
        --bs-nav-tabs-link-active-color: #{$texto-light};
        --bs-nav-tabs-link-active-bg: #{$color-light};
    }

}
