@use "sass:map";

@function convertir-hex-rgba($color, $opacidad: .5) {
    @return RGBA(to-rgb($color), $opacidad);
}

@function evaluar-color($color) {
    @if contrast-ratio($color, $white) > $min-contrast-ratio {
        @return 'oscuro';
    } @else {
        @return 'claro';
    }
}

@function cambiar-luminosidad($color, $weight) {
    @if evaluar-color($color) == 'oscuro' {
        @return if($weight > 0, mix($color, black, $weight), mix($color, white, -$weight));
    } @else {
        @return if($weight > 0, mix($color, white, $weight), mix($color, black, -$weight));
    }
}

@function cambiar-matiz($color, $degrees) {
    @return hsl(hue($color) + $degrees, saturation($color), lightness($color));
}

@function ajustar-matiz-al-tema($color, $target-hue) {
    $current-hue: hue($color);
    $hue-difference: $target-hue - $current-hue;
    @if abs($hue-difference) > 180 {
        $hue-difference: $hue-difference - 360 * if($hue-difference > 0, -1, 1);
    }
    @return cambiar-matiz($color, $hue-difference);
}

@function generar-paleta-mono($color) {
    $escala: ();
    $lightness: lightness($color);
    @for $i from 1 through 9 {
        $new-color: mix($color, white, 10% * $i);
        $escala: map-merge($escala, ('mono-' + (50 + ($i - 1) * 50): $new-color));
    }
    $escala: map-merge($escala, ('mono-500': $color));
    @for $i from 1 through 9 {
        $new-color: mix($color, black, 10% * $i);
        $escala: map-merge($escala, ('mono-' + (950 - ($i - 1) * 50): $new-color));
    }
    @return (
        'mono-1': map-get($escala, 'mono-100'),
        'mono-2': map-get($escala, 'mono-200'),
        'mono-3': map-get($escala, 'mono-350'),
        'mono-4': map-get($escala, 'mono-500'),
        'mono-5': map-get($escala, 'mono-650'),
        'mono-6': map-get($escala, 'mono-800'),
        'mono-7': map-get($escala, 'mono-900'),
    );
}

@function generar-paleta-saturacion($color) {
    $escala: ();
    $base-level: 500;
    $incremento-saturacion: 10%;
    @for $i from 1 through 9 {
        $color-saturado: saturate($color, $incremento-saturacion * $i);
        $color-desaturado: desaturate($color, $incremento-saturacion * $i);
        $escala: map-merge($escala, (
            'satu-' + ($base-level - $i * 50): $color-desaturado,
            'satu-' + ($base-level + $i * 50): $color-saturado
        ));
    }
    $escala: map-merge($escala, ('satu-500': $color));
    @return (
        'satu-1': map-get($escala, 'satu-100'),
        'satu-2': map-get($escala, 'satu-200'),
        'satu-3': map-get($escala, 'satu-400'),
        'satu-4': map-get($escala, 'satu-500'),
        'satu-5': map-get($escala, 'satu-600'),
        'satu-6': map-get($escala, 'satu-750'),
        'satu-7': map-get($escala, 'satu-900'),
    );
}

@function generar-paleta-ampliada($color) {
    $fondo: desaturate(lighten($color, 20%), 20%);
    @return (
        'fondo':        $fondo,
        'fondo2':       cambiar-luminosidad($fondo, 60%),
        'fondo3':       cambiar-luminosidad($fondo, 30%),
        'analo-1':      cambiar-matiz($color, 30deg),
        'analo-2':      cambiar-matiz($color, -30deg),
        'triad-1':      cambiar-matiz($color, 120deg),
        'triad-2':      cambiar-matiz($color, 240deg),
        'tetra-1':      cambiar-matiz($color, 60deg),
        'tetra-2':      cambiar-matiz($color, -60deg),
        'cuad-1':       cambiar-matiz($color, 90deg),
        'cuad-2':       cambiar-matiz($color, -90deg),
        'inverso':      cambiar-matiz($color, 180deg),
        'comp-1':       cambiar-matiz(cambiar-matiz($color, 180deg), 30deg),
        'comp-2':       cambiar-matiz(cambiar-matiz($color, 180deg), -30deg),
        'accent':       saturate(darken($color, 10%), 50%),
        'highlight':    saturate(lighten($color, 15%), 25%),
        'gray':         $gray-600,
        'white':        $white,
        'black':        $black,
    );
}

@function generar-paleta-basica($color) {
    $danger:    ajustar-matiz-al-tema($color, 0);
    $success:   ajustar-matiz-al-tema($color, 120);
    $info:      ajustar-matiz-al-tema($color, 240);
    $warning:   ajustar-matiz-al-tema($color, 60);
    @if evaluar-color($color) == 'oscuro' {
        $danger:    lighten($danger, 10%);
        $success:   lighten($success, 10%);
        $info:      lighten($info, 10%);
        $warning:   lighten($warning, 10%);
    }
    @return (
        'primary':      $color,
        'light':        lighten($color, 25%),
        'dark':         darken($color, 20%),
        'secondary':    desaturate(darken($color, 10%), 50%),
        'success':      desaturate($success, 10%),
        'info':         desaturate($info, 10%),
        'warning':      saturate($warning, 10%),
        'danger':       saturate($danger, 10%),
    );
}

@function definir-parametros($paleta-basica, $paleta-ampliada, $paleta-mono, $paleta-saturacion) {
    $color-fondo:       map-get($paleta-ampliada, 'fondo');
    $color-fondo2:      cambiar-luminosidad($color-fondo, 30%);
    $color-fondo3:      cambiar-luminosidad($color-fondo, 60%);
    $color-enlace:      color-contrast($color-fondo);
    $color-enlace2:     lighten(color-contrast($color-fondo), 50%);
    $color-borde:       map-get($paleta-mono, 'mono-5');
    $color-borde2:      map-get($paleta-mono, 'mono-7');
    $color-separador:   map-get($paleta-mono, 'mono-6');
    $estilo-titulos:    map-get($paleta-mono, 'mono-2');
    $color-menu:        darken($color-fondo, 10%);
    $color-menu2:       darken($color-fondo, 50%);
    @if evaluar-color($color-fondo) == 'oscuro' {
        $color-enlace2:     darken(color-contrast($color-fondo), 20%);
        $color-borde:       map-get($paleta-mono, 'mono-2');
        $color-borde2:      map-get($paleta-mono, 'mono-1');
        $color-separador:   map-get($paleta-mono, 'mono-2');
        $estilo-titulos:    map-get($paleta-mono, 'mono-6');
        $color-menu:        lighten($color-fondo, 10%);
        $color-menu2:       lighten($color-fondo, 50%);
    }
    @return (
        fuente-base:            'Verdana, Geneva, Tahoma, sans-serif',
        talla-base:             1rem,
        color-separador:        $color-separador,
        color-borde:            $color-borde,
        color-borde2:           $color-borde2,
        estilo-titulos:         $estilo-titulos,
        color-enlace:           $color-enlace,
        color-enlace2:          $color-enlace2,
        color-menu:             $color-menu,
        color-menu2:            $color-menu2,
        color-fondo:            $color-fondo,
        color-fondo2:           $color-fondo2,
        color-fondo3:           $color-fondo3,
        color-texto:            color-contrast($color-fondo),
        color-texto2:           color-contrast($color-fondo2),
        color-texto3:           color-contrast($color-fondo3),
        paleta-basica:          $paleta-basica,
        paleta-ampliada:        $paleta-ampliada,
        paleta-mono:            $paleta-mono,
        paleta-saturacion:      $paleta-saturacion,
    );
}

@mixin configurar-tema($parametros) {
    --bsia-color-sombra-rgba:   #{convertir-hex-rgba(map-get($parametros, color-texto))};
    --bsia-color-separador:     #{map-get($parametros, color-separador)};
    --bsia-color-borde:         #{map-get($parametros, color-borde)};
    --bsia-color-borde2:        #{map-get($parametros, color-borde2)};
    --bsia-estilo-titulos:      #{map-get($parametros, estilo-titulos)};
    //--bs-heading-color: ?;
    //+ Usar font-style: italic; margin-top: 1rem; margin-bottom: 2rem;
    //+ text-shadow: 0.1em 0.1em 0.15em #252850

    --bs-body-font-family:      #{map-get($parametros, fuente-base)};
    --bs-body-font-size:        #{map-get($parametros, talla-base)};
    --bs-body-bg:               #{map-get($parametros, color-fondo)};
    --bs-body-bg-rgb:           #{to-rgb(map-get($parametros, color-fondo))};
    --bs-body-color:            #{map-get($parametros, color-texto)};
    --bs-body-color-rgb:        #{to-rgb(map-get($parametros, color-texto))};
    --bs-emphasis-color:        #{map-get($parametros, color-texto)};
    --bs-emphasis-color-rgb:    #{to-rgb(map-get($parametros, color-texto))};
    --bs-link-color:            #{map-get($parametros, color-enlace)};
    --bs-link-color-rgb:        #{to-rgb(map-get($parametros, color-enlace))};
    --bs-link-hover-color:      #{map-get($parametros, color-enlace2)};
    --bs-link-hover-color-rgb:  #{to-rgb(map-get($parametros, color-enlace2))};
    --bs-secondary-bg:          #{map-get($parametros, color-fondo2)};
    --bs-secondary-bg-rgb:      #{to-rgb(map-get($parametros, color-fondo2))};
    --bs-secondary-color:       #{map-get($parametros, color-texto2)};
    --bs-secondary-color-rgb:   #{to-rgb(map-get($parametros, color-texto2))};
    --bs-tertiary-bg:           #{map-get($parametros, color-fondo3)};
    --bs-tertiary-bg-rgb:       #{to-rgb(map-get($parametros, color-fondo3))};
    --bs-tertiary-color:        #{map-get($parametros, color-texto3)};
    --bs-tertiary-color-rgb:    #{to-rgb(map-get($parametros, color-texto3))};
    --bs-border-color:          var(--bsia-color-borde);
    --bs-box-shadow-sm:         0 0.125rem .25rem #{convertir-hex-rgba(map-get($parametros, color-texto), 0.3)};
    --bs-box-shadow:            0 0.5rem 1rem #{convertir-hex-rgba(map-get($parametros, color-texto), 0.4)};
    --bs-box-shadow-lg:         0 1rem 3rem #{convertir-hex-rgba(map-get($parametros, color-texto), 0.5)};
    --bs-box-shadow-inset:      inset 0 1px 2px #{convertir-hex-rgba(map-get($parametros, color-texto), 0.25)};
    --bs-focus-ring-color:      #{convertir-hex-rgba(map-get(map-get($parametros, paleta-basica), 'primary'), 0.25)};
    --bs-focus-ring-width:      0.25rem;
    --bs-focus-ring-opacity:    0.25;
    --bs-border-color-translucent: #{convertir-hex-rgba(map-get($parametros, color-texto))};

    @each $nombre, $valor in map-get($parametros, paleta-basica) {
        --bs-#{$nombre}:                #{$valor};
        --bs-#{$nombre}-rgb:            #{to-rgb($valor)};
        --bs-#{$nombre}-text-emphasis:  #{cambiar-luminosidad($valor, -20%)};
        --bs-#{$nombre}-bg-subtle:      #{cambiar-luminosidad($valor, 80%)};
        --bs-#{$nombre}-border-subtle:  #{cambiar-luminosidad($valor, 50%)};
        .list-group-item-#{$nombre} {
            --bs-list-group-color:                  var(--bs-#{$nombre}-text-emphasis);
            --bs-list-group-action-hover-color:     var(--bs-#{$nombre}-text-emphasis);
            --bs-list-group-action-active-color:    var(--bs-#{$nombre}-text-emphasis);
            --bs-list-group-active-color:           var(--bs-#{$nombre}-text-emphasis);
        }
        .bg-#{$nombre} {
            background-color: $valor !important;
        }
        .text-#{$nombre} {
            color: $valor !important;
        }
        .text-bg-#{$nombre} {
            background-color:   $valor !important;
            color:              color-contrast($valor) !important;
        }
        .btn-#{$nombre} {
            @include button-variant($valor, $valor);
        }
        .btn-outline-#{$nombre} {
            @include button-outline-variant($valor);
        }
    }
    @each $nombre, $valor in map-get($parametros, paleta-ampliada) {
        --bsia-#{$nombre}: #{$valor};
        .text-bg-#{$nombre} {
            background-color:   $valor !important;
            color:              color-contrast($valor) !important;
        }
    }
    @each $nombre, $valor in map-get($parametros, paleta-mono) {
        --bsia-#{$nombre}: #{$valor};
        .text-bg-#{$nombre} {
            background-color:   $valor !important;
            color:              color-contrast($valor) !important;
        }
    }
    @each $nombre, $valor in map-get($parametros, paleta-saturacion) {
        .text-bg-#{$nombre} {
            background-color:   $valor !important;
            color:              color-contrast($valor) !important;
        }
    }
    .dropdown-menu {
        --bs-dropdown-color:                #{color-contrast(map-get($parametros, color-menu))};
        --bs-dropdown-bg:                   #{map-get($parametros, color-menu)};
        --bs-dropdown-link-color:           #{color-contrast(map-get($parametros, color-menu))};
        --bs-dropdown-link-hover-bg:        #{map-get($parametros, color-menu2)};
        --bs-dropdown-link-hover-color:     #{color-contrast(map-get($parametros, color-menu2))};
        --bs-dropdown-link-active-bg:       #{map-get(map-get($parametros, paleta-ampliada), 'accent')};
        --bs-dropdown-link-active-color:    #{color-contrast(map-get(map-get($parametros, paleta-ampliada), 'accent'))};
    }
    .nav-tabs {
        --bs-nav-link-color:                    #{map-get($parametros, color-texto)};
        --bs-nav-link-hover-color:              #{map-get($parametros, color-texto)};
        --bs-nav-tabs-link-active-bg:           #{map-get(map-get($parametros, paleta-ampliada), 'highlight')};
        --bs-nav-tabs-link-active-color:        #{color-contrast(map-get(map-get($parametros, paleta-ampliada), 'highlight'))};
        --bs-nav-tabs-border-color:             var(--bsia-color-borde);
        --bs-nav-tabs-link-active-border-color: var(--bsia-color-borde) var(--bsia-color-borde) transparent;
        --bs-nav-tabs-link-hover-border-color:  var(--bsia-color-borde2) var(--bsia-color-borde2) transparent;
    }

    //$accordion-button-focus-box-shadow: '';
    //$accordion-icon-color-dark: $white;
    //$accordion-icon-active-color-dark: $white;
    //$accordion-button-icon-dark: url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='none' stroke='#{$accordion-icon-color-dark}' stroke-linecap='round' stroke-linejoin='round'><path d='M2 5L8 11L14 5'/></svg>");
    //$accordion-button-active-icon-dark: url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='none' stroke='#{$accordion-icon-active-color-dark}' stroke-linecap='round' stroke-linejoin='round'><path d='M2 5L8 11L14 5'/></svg>");

}
